<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediConnect: Dynamic Healthcare Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Lucide Icons for modern, clean icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom font and base styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            /* Very light blue/gray background */
            color: #1e293b;
            line-height: 1.6;
        }

        /* Gradient for the main hero section */
        .hero-gradient {
            background: linear-gradient(135deg, #4c51bf 0%, #3b82f6 100%);
            /* Indigo to Blue */
        }

        /* Card hover effect using custom CSS */
        .action-card {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Custom spinner for loading icon */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-custom {
            animation: spin 1.5s linear infinite;
        }
    </style>
</head>

<body class="min-h-screen">

    <!-- Header & Hero Section (Project Overview) -->
    <header class="hero-gradient text-white p-8 md:p-16 shadow-xl">
        <div class="max-w-6xl mx-auto text-center">
            <div class="flex items-center justify-center space-x-3 mb-2">
                <i data-lucide="shield-check" class="w-8 h-8 md:w-10 md:h-10 text-white"></i>
                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight">
                    MediConnect
                </h1>
            </div>
            <p class="text-xl md:text-2xl font-light mt-4 max-w-3xl mx-auto opacity-90">
                The future of healthcare management: Seamless booking, secure records, and instant doctor access.
            </p>
            <a href="#access-portal"
                class="inline-block mt-8 px-8 py-3 bg-white text-indigo-700 font-bold rounded-full text-lg shadow-lg hover:bg-gray-100 transition duration-300 transform hover:scale-105">
                Get Started Now
            </a>
        </div>
    </header>

    <!-- Access Portal Section (Login/Register Links) -->
    <section id="access-portal" class="py-16 md:py-24">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800">Access Your Dedicated Portal</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Card 1: Patient Access (Indigo Focus) -->
                <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-8 border-indigo-500 action-card">
                    <div class="flex items-center space-x-4 mb-6">
                        <i data-lucide="user-check" class="w-10 h-10 text-indigo-600"></i>
                        <h3 class="text-2xl font-bold text-indigo-800">I Am a Patient</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Book appointments, view your medical history, and manage your profile
                        quickly and easily.</p>

                    <div class="space-y-4">
                        <a href="/patient-login"
                            class="flex items-center justify-center w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 shadow-md">
                            <i data-lucide="log-in" class="w-5 h-5 mr-2"></i> Patient Login
                        </a>
                        <a href="/patient"
                            class="flex items-center justify-center w-full px-6 py-3 bg-indigo-100 text-indigo-700 font-semibold rounded-lg hover:bg-indigo-200 shadow-md">
                            <i data-lucide="user-plus" class="w-5 h-5 mr-2"></i> Register New Patient
                        </a>
                    </div>
                </div>

                <!-- Card 2: Doctor Access (Cyan Focus) -->
                <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-8 border-cyan-500 action-card">
                    <div class="flex items-center space-x-4 mb-6">
                        <i data-lucide="stethoscope" class="w-10 h-10 text-cyan-600"></i>
                        <h3 class="text-2xl font-bold text-cyan-800">I Am a Doctor/Staff</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Manage your schedule, review patient appointments, and track
                        consultation fees.</p>

                    <div class="space-y-4">
                        <a href="/doctor-login"
                            class="flex items-center justify-center w-full px-6 py-3 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 shadow-md">
                            <i data-lucide="log-in" class="w-5 h-5 mr-2"></i> Doctor Login
                        </a>
                        <a href="/doctor-register-form"
                            class="flex items-center justify-center w-full px-6 py-3 bg-cyan-100 text-cyan-700 font-semibold rounded-lg hover:bg-cyan-200 shadow-md">
                            <i data-lucide="file-text" class="w-5 h-5 mr-2"></i> Doctor Registration Form
                        </a>
                    </div>
                </div>

                <!-- Card 3: AI/Nutrition Access (Lime Focus) -->
                <div class="bg-white p-8 rounded-2xl shadow-2xl border-t-8 border-lime-500 action-card">
                    <div class="flex items-center space-x-4 mb-6">
                        <i data-lucide="brain" class="w-10 h-10 text-lime-600"></i>
                        <h3 class="text-2xl font-bold text-lime-800">Nutrition AI Planner</h3>
                    </div>
                    <p class="text-gray-600 mb-6">Get personalized 7-day nutrition plans and instant health tips using
                        our Gemini-powered AI advisor.</p>

                    <div class="space-y-4">
                        <a href="/ai"
                            class="flex items-center justify-center w-full px-6 py-3 bg-lime-600 text-white font-semibold rounded-lg hover:bg-lime-700 shadow-md">
                            <i data-lucide="clipboard-list" class="w-5 h-5 mr-2"></i> Get My Plan Now
                        </a>
                        <a href="#dynamic-health-fact"
                            class="flex items-center justify-center w-full px-6 py-3 bg-lime-100 text-lime-700 font-semibold rounded-lg hover:bg-lime-200 shadow-md">
                            <i data-lucide="lightbulb" class="w-5 h-5 mr-2"></i> See Daily Fact
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- DYNAMIC API SECTION (Health/Food Info) -->
    <section class="py-10 bg-gray-100 border-t border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-xl font-bold text-center mb-6 text-gray-700 flex items-center justify-center space-x-2">
                <i data-lucide="leaf" class="w-6 h-6 text-green-600"></i>
                <span>Daily Health Insight ✨</span>
            </h2>
            <!-- This is the container where the API data will be injected -->
            <div id="dynamic-health-fact" class="min-h-[100px] flex text-sm items-center justify-center">
                <!-- Loading state will be here initially -->
            </div>
        </div>
    </section>

    <!-- Value Proposition / Features Section (Moved to bottom) -->
    <section class="py-12 md:py-20 bg-white border-t border-gray-200">
        <div class="max-w-6xl mx-auto px-6">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800">Why Choose MediConnect?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">

                <!-- Feature 1: Instant Booking (Indigo) -->
                <div class="p-6 bg-indigo-50 rounded-xl shadow-md flex items-start space-x-4">
                    <i data-lucide="calendar-check" class="w-8 h-8 text-indigo-600 flex-shrink-0"></i>
                    <div>
                        <h3 class="text-xl font-semibold text-indigo-800 mb-1">Instant Booking</h3>
                        <p class="text-gray-600 text-sm">Find and secure appointments with your preferred doctor in
                            seconds, not days.</p>
                    </div>
                </div>

                <!-- Feature 2: Secure Records (Green) -->
                <div class="p-6 bg-green-50 rounded-xl shadow-md flex items-start space-x-4">
                    <i data-lucide="lock" class="w-8 h-8 text-green-600 flex-shrink-0"></i>
                    <div>
                        <h3 class="text-xl font-semibold text-green-800 mb-1">Secure Records</h3>
                        <p class="text-gray-600 text-sm">Your medical data is protected with enterprise-grade security
                            and privacy compliance.</p>
                    </div>
                </div>

                <!-- Feature 3: Professional Tools (Cyan) -->
                <div class="p-6 bg-cyan-50 rounded-xl shadow-md flex items-start space-x-4">
                    <i data-lucide="award" class="w-8 h-8 text-cyan-600 flex-shrink-0"></i>
                    <div>
                        <h3 class="text-xl font-semibold text-cyan-800 mb-1">Professional Tools</h3>
                        <p class="text-gray-600 text-sm">Empowering medical professionals with streamlined schedule and
                            patient overview.</p>
                    </div>
                </div>
                
                <!-- Feature 4: Intelligent Nutrition (Lime/AI) - NEW CARD ADDED -->
                <div class="p-6 bg-lime-50 rounded-xl shadow-md flex items-start space-x-4">
                    <i data-lucide="brain-circuit" class="w-8 h-8 text-lime-600 flex-shrink-0"></i>
                    <div>
                        <h3 class="text-xl font-semibold text-lime-800 mb-1">Intelligent Nutrition</h3>
                        <p class="text-gray-600 text-sm">Get instant, personalized meal plans and health guidance powered by advanced AI.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 text-center">
        <p class="text-sm">
            &copy; 2025 MediConnect | Designed for a seamless healthcare experience.
        </p>
    </footer>

    <!-- Initialize Lucide Icons and API Fetch Script -->
    <script>
        // Initialize icons on page load
        lucide.createIcons();

        // --- DYNAMIC LLM FETCH LOGIC ---
        const factContainer = document.getElementById('dynamic-health-fact');
        const apiKey = "AIzaSyBYUzsnXPEDZZU_d8pTs_KZFL9QrL8PCyc"; // API key is provided by the environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Helper function for exponential backoff (crucial for API stability)
        async function fetchWithBackoff(url, options, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        console.warn(`Rate limit hit (429). Retrying in ${delay * (2 ** i)}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                        continue;
                    }
                    if (!response.ok) {
                        // Throw non-retriable errors immediately, including the status code
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    // Log connection errors but don't stop retry loop
                    await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));
                }
            }
        }

        function renderFact(text, sources, container) {
            let sourceHtml = '';
            // 2. Format citations if they exist
            if (sources.length > 0) {
                sourceHtml = '<p class="text-xs text-gray-500 mt-3 border-t border-gray-100 pt-2">Grounded in research from: ';
                sources.forEach((source, index) => {
                    sourceHtml += `<a href="${source.uri}" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline font-medium">${source.title}</a>`;
                    if (index < sources.length - 1) {
                        sourceHtml += ', ';
                    }
                });
                sourceHtml += '</p>';
            }

            // Attempt to auto-extract title and body (assuming the LLM followed the prompt and bolded the title)
            const parts = text.split('**').filter(p => p.trim());
            let title = "Daily Health Insight ✨";
            let body = text;

            if (parts.length >= 2) {
                title = parts[1]; // The text between the first and second **
                body = parts.slice(2).join(' ').trim(); // Remaining text is the body
            } else if (text.startsWith('**')) {
                // Handle cases where the model only provided one bolded section
                const firstBoldEnd = text.indexOf('**', 2);
                if (firstBoldEnd > 0) {
                    title = text.substring(2, firstBoldEnd).trim();
                    body = text.substring(firstBoldEnd + 2).trim();
                }
            }

            // Default icon to use if one isn't passed from LLM or structured data (not used here)
            const icon = 'bulb';

            // 3. Inject the dynamic HTML content
            container.innerHTML = `
                <div class="max-w-3xl mx-auto p-5 bg-white rounded-xl shadow-2xl border-l-4 border-green-500 flex space-x-5">
                    <i data-lucide="${icon}" class="w-10 h-10 text-green-600 flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="text-xl font-bold text-gray-800">${title}</h4>
                        <p class="text-gray-600 mt-2">${body}</p>
                        ${sourceHtml}
                    </div>
                </div>
            `;
            lucide.createIcons(); // Re-initialize icons after DOM update
        }

        async function fetchHealthFact() {
            // Show loading state
            factContainer.innerHTML = '<span class="text-indigo-500 flex items-center text-lg font-medium"><i data-lucide="loader-circle" class="w-6 h-6 mr-3 animate-spin-custom"></i> Loading today\'s health insight...</span>';
            lucide.createIcons();

            const systemPrompt = "You are a friendly, authoritative health and nutrition advisor. Provide one concise, actionable health or food fact for the day. Format your response by clearly bolding the title (2-5 words) followed by a short, simple paragraph of 1-2 sentences. Do not use Markdown headings like # or ##.";
            const userQuery = "Give me one current, interesting fact about diet, exercise, or general wellness. Ensure the response is authoritative and based on current web results.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // CRITICAL: Enable Google Search for grounded, current facts
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithBackoff(apiUrl, options);
                const result = await response.json();

                const candidate = result.candidates?.[0];
                let factText = "Could not generate fact. Try refreshing the page.";
                let sources = [];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    factText = candidate.content.parts[0].text;

                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }
                }

                renderFact(factText, sources, factContainer);

            } catch (error) {
                console.error("Gemini API Request Failed:", error.message);
                factContainer.innerHTML = `
                    <div class="max-w-3xl mx-auto p-5 bg-red-50 rounded-xl border-l-4 border-red-500">
                        <p class="text-red-700 flex items-center font-medium">
                            <i data-lucide="alert-triangle" class="w-5 h-5 mr-3"></i> 
                            API Connection Failed (403 Forbidden). Please check your API key's validity and permissions.
                        </p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        // Run the fetch function when the page content is loaded
        document.addEventListener('DOMContentLoaded', fetchHealthFact);
    </script>
</body>

</html>
